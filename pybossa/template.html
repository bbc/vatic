<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<style>
.navbar-default {
      background-color: #546e7a;
}
#attributes
{
  background-color: #ffffff;
  border-top: 4px solid #000000;
  bottom: 0;
  left: 0;
  height: 180px;
  overflow: auto;
  padding-bottom: 2em;
  position: fixed;
  white-space: nowrap;
  width: 100%;
  z-index: 2;
  float:left;
  display: block
}

.face-label {
  display: inline-block;
  text-align: center;
  font-size: xx-small;
  padding: 1em;
  border-style: solid;
  border-width: thick;
  border-color: white;
}
.face-label img {
  height: 160px;
}

.attribute-selected {
  border-color: yellow;
}
#videoframe
{
    background-color : #000;
    display : block;
    height: 500px;
}

#videoframe * {
  box-sizing: content-box;
}

#sidebar {
    height: 500px;
    display: block;
    overflow: auto;
}

.trackobject
{
    border : 2px solid black;
    font-family : Arial;
    font-size : 14px;
}

.trackobjectfoldedup
{
}

.trackobjectfoldeddown
{
}

.trackobject p, .trackobject li, .trackobject label
{
    font-family : Arial;
    font-size : 14px !important;
}

.trackobject .label:hover
{
    font-weight : bold;
}

.trackobject p
{
    padding : 2px;
    margin : 0;
}

.trackobject ul, ol
{
    margin : 0;
    padding : 0;
    margin-left : 30px;
}

.trackobjectheader
{
    margin : 0;
    padding : 3px !important;
    /*cursor : pointer;*/
}

.trackobjectheader:hover
{
    /*text-decoration : underline;*/
}

.trackobjectheader .ui-icon
{
    float : left;
}

.boundingbox
{
    position : absolute !important;
    border-style : solid;
    border-width : 2px;
    z-index : 5;
}
.ui-selected {
  border-style: dotted;
}

.boundingbox .boundingboxtext
{
    font-size : 14px;
    /*margin-top : -18px;*/
    color : #fff;

    position : absolute;
    margin-left : -80px;
    margin-top : -2px;
    width : 75px;
    text-align : right;

    padding : 1px;
    padding-right : 3px;
    cursor : default;
    z-index : 0;

    text-shadow: -1px 0 2px #000, 0px 1px 2px #000, 1px 0 2px #000, 0 -1px 2px #000; 
    -moz-text-shadow: -1px 0 2px #000, 0px 1px 2px #000, 1px 0 2px #000, 0 -1px 2px #000; 
    -webkit-text-shadow: -1px 0 2px #000, 0px 1px 2px #000, 1px 0 2px #000, 0 -1px 2px #000; 
}

.boundingboxhighlight .boundingboxtext
{
    text-shadow: -1px 0 5px #000, 0px 1px 5px #000, 1px 0 5px #000, 0 -1px 5px #000; 
    -moz-text-shadow: -1px 0 5px #000, 0px 1px 5px #000, 1px 0 5px #000, 0 -1px 5px #000; 
    -webkit-text-shadow: -1px 0 5px #000, 0px 1px 5px #000, 1px 0 5px #000, 0 -1px 5px #000; 
    z-index : 1;
}

.boundingbox .fill
{
    width : 100%;
    height : 100%;
    display : block;
    display : none;
}

.boundingboxhighlight
{
    z-index : 10;
}

.boundingboxhighlight .fill
{
    opacity : 0.25;
    display : block;
}

.boundingboxoccluded
{
    border-style : dashed;
}

.ui-resizable-disabled
{
    opacity : 1.0 !important;
}

.boundingboxdim
{
    opacity : 0.3 !important; 
}

.boundingboxlocked
{
    z-index : 0;
    opacity : 0.3 !important;
}

.boundingboxhighlight
{
    opacity : 1 !important;
}

.boxtooltip
{
    position : absolute;
    width : 200px;
    height : 200px;
    z-index : 100;
    border : 5px solid #000;
    background-color : #000;
    background-repeat : no-repeat;
    -moz-box-shadow: 2px 2px 10px #000, -2px 2px 10px #000, 2px -2px 10px #000, -2px -2px 10px #000;
    -webkit-box-shadow: 2px 2px 10px #000, -2px 2px 10px #000, 2px -2px 10px #000, -2px -2px 10px #000;
    box-shadow: 2px 2px 10px #000, -2px 2px 10px #000, 2px -2px 10px #000, -2px -2px 10px #000;
}

.boxtooltip .boundingbox
{
    position : relative;
    z-index : 101;
}

</style>
<div class="row">
  <div style="height: 75px">
    <div id="success" class="alert alert-success" style="display:none;">
      <a class="close">×</a>
      <strong>Well done!</strong> Your answer has been saved
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
      <a class="close">×</a>
      Loading next task...
      <div class="progress" id='loading-progress'>
        <div class="progress-bar progress-bar-striped active"></div>
      </div>
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
      <strong>The task has been completed!</strong>
      Thanks a lot!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
      <strong>Congratulations!</strong>
      You have participated in all available tasks!
      <br/>
      <div class="alert-actions">
        <a class="btn btn-info small" href="/">Go back</a>
        or
        <a class="btn btn-info small" href="/project">Check other projects</a>
      </div>
      </div>
      <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">×</a>
        <strong>Error!</strong>
        Something went wrong, please contact the site administrators
      </div>
    </div>
</div>
<div id='annotatescreen' class="skeleton">
  <table>
    <tr>
      <td>
        <div id='videoframe'></div>
      </td>
      <td id='sidebar'>
        <div id='objectcontainer'></div>
      </td>
    </tr>
  </table>
  <div class="row">
    <div class="col-md-12" id='bottombar'>
      <div class="progress" id='playerslider'>
        <div class="progress-bar progress-bar-striped active"></div>
      </div>
      <button class='btn' id='rewindbutton' disabled><span class="glyphicon glyphicon-fast-backward" aria-hidden="true"></span></button>
      <button class='btn' id='playbutton'><span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>
      <button class='btn' id='newobjectbutton'>New Object</button>
      <button id='submitbutton' class='btn btn-primary'>Submit</button>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <button class='btn' id='openadvancedoptions'>Display Options</button>
      <div id='advancedoptions' style='display: none;'>
        <button class='btn' id='closeadvancedoptions'>Hide Options</button>
        <label for='annotateoptionsresize'>
          <input type='checkbox' id='annotateoptionsresize'>
          Disable Resize?
        </label>
        <label for='annotateoptionshideboxes'>
          <input type='checkbox' id='annotateoptionshideboxes'>
          Hide Boxes?
        </label>
        <label for='annotateoptionshideboxtext'>
          <input type='checkbox' id='annotateoptionshideboxtext'>
          Hide Labels?
        </label>
        <div id='speedcontrol'>
          <label for='speedcontrolslower'>
            <input type='radio' name='speedcontrol' value='5,1' id='speedcontrolslower'>
            Slower
          </label>
          <label for='speedcontrolslow'>
            <input type='radio' name='speedcontrol' value='15,1' id='speedcontrolslow'>
            Slow
          </label>
          <label for='speedcontrolnorm'>
            <input type='radio' name='speedcontrol' value='30,1' id='speedcontrolnorm' checked='checked'>
            Normal
          </label>
          <label for='speedcontrolfast'>
            <input type='radio' name='speedcontrol' value='90,1' id='speedcontrolfast'>
            Fast
          </label>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="attributes"></div>
<div class="hidden" id='preloadpit'></div>
<script type="text/javascript">
(function() {
  pybossa.taskLoaded(function(task, deferred){
    if ( !$.isEmptyObject(task) ) {
      console.log("taskLoaded" + task);
      $("#success").hide();
      $("#error").hide();
      var faceTrack = "/static/vatic/" + task.info.slug + "/" + task.info.jobid +".json" 
      $.getJSON( faceTrack, function( data ) {              
        job = job_import(task.info, data);
        preloadvideo(job.start, job.stop, job.frameurl,
          preloadslider($("#loadingscreenslider"),
            function(progress) {
              $("#loading-progress").children(".progress-bar").width(progress * 100 + "%");
              if (progress == 1) {
                $("#loading").hide();                
                console.log("hiding")
                deferred.resolve(task);
              } else {
                $("#loading").show();
              }
            }
          )
        );
      });
    } else {
      deferred.resolve(task);
    }
  });
        
  function loadUserProgress() {
    pybossa.userProgress('facerec').done(function(data){
      var pct = Math.round((data.done*100)/data.total);
      $("#progress").css("width", pct.toString() +"%");
      $("#progress").attr("title", pct.toString() + "% completed!");
      $("#progress").tooltip({'placement': 'left'});
      $("#total").text(data.total);
      $("#done").text(data.done);
    });
  }

 pybossa.presentTask(function(task, deferred){
   if ( !$.isEmptyObject(task) ) {
     $("#success").hide();
     $("#error").hide();          

     var faceTrack = "/static/vatic/" + task.info.slug + "/" + task.info.jobid +".json" 
     console.log("presentTask")
     $.getJSON(faceTrack, function( data ) {
       ui_build(task, deferred, job_import(task.info, data));
     });
     $("#loading").hide();
   } else {
     $("#success").hide();
     $("#error").hide();
     $("#annotatescreen").hide();
     $("#loading").hide();
     $("#finish").fadeIn(500);
   }
 });

 pybossa.run('facerec');
})();
</script>
